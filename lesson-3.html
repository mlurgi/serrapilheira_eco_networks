<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>2.- The Assembly of Ecological Networks Across Spatial Scales</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<meta name="description" content="Turn your analyses into high quality documents, reports, presentations and dashboards with R Markdown. Use a productive notebook interface to weave together narrative text and code to produce elegantly formatted output. Use multiple languages including R, Python, and SQL. R Markdown supports a reproducible workflow for dozens of static and dynamic output formats including HTML, PDF, MS Word, Beamer, HTML5 slides, Tufte-style handouts, books, dashboards, shiny applications, scientific articles, websites, and more." />

<link rel="icon" type="image/png" href="images/favicon.png" />

<script type="text/javascript" src="js/redirect.js"></script>
<script type="text/javascript" src="js/rmarkdown.js"></script>
<script type="text/javascript" src="js/ga.js"></script>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
      .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="css/rmarkdown.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="rStudioHeader" class="alwaysShrunk">
  <div class="innards bandContent">
    <div>
      <a class="productName" href="index.html">Community Ecology and Biodiversity</a>
      <div class="Networks">    </div>
    </div>

    <div id="menu">
      <div id="menuToggler"></div>
      <div id="menuItems">
        <a class="menuItem" href="lesson-1.html">Get Started</a>
        
      </div>
    </div>
  </div>
</div>

<style type="text/css">
#TOC {
  margin-left: 35px;
  margin-top: 90px;
}
</style>

<script type="text/javascript">
$(".main-container").removeClass("main-container").removeClass("container-fluid").addClass("footerPushDown");
</script>


<div id="pageContent" class="standardPadding">
  <div class="articleBandContent">
<div class="lessonPage">
  <div class="lessonsNav">
    <a id="nav-lesson-1" href="lesson-1.html">Introduction</a>
    <a id="nav-lesson-2" href="lesson-2.html">1.- Network Structure: Construction and Metrics</a>
    <a id="nav-lesson-3" href="lesson-3.html">2.- The Assembly of Ecological Networks Across Spatial Scales</a>
    <a id="nav-lesson-4" href="lesson-4.html">Networks as Graphs</a>
    <a id="nav-lesson-5" href="lesson-5.html">Food Web Properties</a>
   
  </div>
  <div class="lessonContent">

<div id="header">



<h1 class="title toc-ignore"><strong>2.- The Assembly of Ecological Networks Across Spatial Scales</strong></h1>

</div>


<p><img src="lesson-images/wallace.png" style="float:right; padding-left:10px" width="200" /></p>
<p>Ever since <a href="https://en.wikipedia.org/wiki/Alfred_Russel_Wallace">Alfred Russel Wallace</a>’s pioneering expeditions to the Malay Archipelago, during which he realised the fundamental differences between neighbouring faunas and their link to the independent evolutionary dynamics that ensue after geographical isolation, ecologists have tried to understand the underlying mechanisms behind the observed geographical distributions of animal and plant species.</p>
<p>Wallace, now considered the father of biogeography, but also jointly with Darwin one of the original proponents of the theory of evolution by natural selection, proposed the separation between islands in the Indonesian Archipelago according to whether the animal species on those islands where from Asian or Australasian origins, in what is now known as Wallace’s line.</p>
<p><img src="lesson-images/wallacea.png" style="float:left; padding-right:10px" width="380" /> The study of the spatial distribution of species has revealed recurrent patterns in the way biodiversity is organised and how it changes across spatial scales, as well as the implications of this organisation for community composition and structure. It has also prompted the development of ecological theory aimed at understanding the mechanisms behind these spatial patterns. Spatial processes thus have since then emerged as one of the fundamental drivers of biodiversity.</p>
<p>One of the spatial patterns of biodiversity that has attracted most attention, not only for its simplicity, but also because of its universality, is the relationship between the size of the area sampled and the number of species found within.</p>
<div id="species-area-relationships" class="section level2">
<h2>2.1- Species-Area relationships</h2>
<p>Arguably one of the only true laws in ecology is the species-area relationship. <strong>Species-Area Relationships (SARs)</strong> describe the relation between area sampled and the number of species present in that area. Species-area relationships were first described by Arrhenius in 1921, who observed similar scaling relationships across plant communities. Since then, many ecologists have collected similar data of species richness across different expanses of areas. Many empirical systems have thus been shown to follow general scaling patterns and this pattern can be described by a <strong>power law</strong>!</p>
<center>
<p><img src="lesson-images/sar-west-indies.png" width="500" /></p>
</center>
<p><strong>Species-area relationship of showing bird species richness as a function of island size in the West Indies.</strong> Image taken from Preston, FW (1962) <em>The canonical distribution of commonness and rarity: Part I</em>. <strong><em>Ecology</em></strong>. 43:2, 185-215.</p>
<p>The seminal paper by <a href="https://www.jstor.org/stable/1931976">Preston in 1962</a> building upon Arrhenius work and presenting SARs like the one above for different faunas, presented canonical values for the parameters of the power law form of the SARs:</p>
<p><img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%20%0AS%20%3D%20c%20A%5Ez%20%20%20%20%20%0A" alt="
S = c A^z     
" title="
S = c A^z     
" class="math display" /></p>
<p>where <em>S</em> is species richness, <em>c</em> is a proportionality constant, <em>A</em> is the area size, and <em>z</em> is the scaling exponent of the relationship. Applying the logarithm to both sides of the equation above, we can linearize and obtain the expression:</p>
<p><img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%20%0Aln%28S%29%20%3D%20ln%28c%29%20%2B%20z%20%2A%20ln%28A%29%0A" alt="
ln(S) = ln(c) + z * ln(A)
" title="
ln(S) = ln(c) + z * ln(A)
" class="math display" /></p>
<p>Making easy to fit a straight line to the log-log relationship of species richness with area size, and the reason why most of the times we see that relationship represented as in the plot above.</p>
<p>The value of <em>z</em> across systems was shown by Preston, and many others after him, to be in the range of 0.1 and 0.5 and usually around the value of 0.25. The existence of this canonical value suggests profound general principles of community richness, and makes it a powerful predictive tool that has been used ever since in biodiversity conservation and studies of extinction during biotic collapse. The value of <em>c</em> and its universality is more debated (see <a href="http://ecflora.cavehill.uwi.edu/bio_courses/ECOL2453/pdfs/species%20area%20relationship.pdf">Lomolino’s account</a> for a nice discussion of the topic).</p>
</div>
<div id="the-theory-of-island-biogeography" class="section level2">
<h2>2.2- The Theory of Island Biogeography</h2>
<p>The discovery of ‘true ecological laws’ such as SARs represented an important advance for the field and for our efforts to better understand biodiversity and its distribution. However, as Simon Levin (<a href="https://esajournals.onlinelibrary.wiley.com/doi/10.2307/1941447">1992</a>) elegantly puts it:</p>
<p><strong><em>“Understanding patterns in terms of the processes that produce them is the essence of science, and is the key to the development of principles for management.”</em></strong></p>
<p>In 1967, two of the most prominent ecologists, <a href="https://en.wikipedia.org/wiki/Robert_H._MacArthur">Robert H. MacArthur</a> and <a href="https://en.wikipedia.org/wiki/E._O._Wilson">Edward O. Wilson</a>, attempted to provide a mechanistic explanation for the distributional patterns of species using a graphical and mathematical framework. This framework has become to be known as the Theory of Island Biogeography. Ever since its development, the Theory of Island Biogeography has formed the backbone of our thinking on species distributions and accumulation of species with area.</p>
<p>The Theory of Island Biogeography poses that the number of species at equilibrium on a given island (or isolated patch of habitat) is given by a compromise between the rates of colonisation and extinction of species. In particular:</p>
<p><img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%20%0AS%20%3D%20%5Cfrac%7BcS_p%7D%7B%28c%2Be%29%7D%0A" alt="
S = \frac{cS_p}{(c+e)}
" title="
S = \frac{cS_p}{(c+e)}
" class="math display" /> where <em>S</em> is the number of species on a given island, <em>S<sub>p</sub></em> is the number of species in the species pool and <em>c</em> and <em>e</em> are the extinction and colonisation rates respectively. MacArthur and Wilson went on and developed a series of theoretical expectations based on the expectation that the colonisation and extinction rates on islands should vary predictably with two main aspects of their geography: 1.- their distance from the mainland (where the species pool is located), and 2.- their size.</p>
<p>Different configurations of distance from the mainland on the one hand, influencing colonisation <strong><em>-the closer an island is to the mainland the higher its probability of being colonised by a species-</em></strong>; and area size on the other, influencing extinctions <strong><em>-the smaller an island the higher the chances a species would go extinct on it due to the limited availability of resources, habitat, etc that accompanies small areas-</em></strong>, thus produce different equilibria in species richness.</p>
<center>
<img src="lesson-images/theory-island-bio.png" width="500" />
</center>
<p>The theoretical framework proposed by the Theory of Island Biogeography has been applied on several settings where species richness in relatively isolated patches depend to one extent or another on a given species pool. Examples of this include mountaintops, forest fragments, or organic particles suspended in the ocean waiting to be colonised by microorganisms.</p>
<p>What about if the interest is in understanding the distribution of a single species across a landscape of patches of habitat?</p>
</div>
<div id="metapopulations" class="section level2">
<h2>2.3- Metapopulations</h2>
<p>In spatially explicit settings, in which several patches of suitable habitat are present, we might be interest in understanding and predicting the occupancy of a species across this landscape (i.e. the fraction of patches that a species can occupy). This exact same question was in the mind of Richard Levins in 1969 when he was trying to predict how much of a crop (habitat) would be attacked (colonised) by a given pest species (coloniser).</p>
<p>He realised that this problem could be formalised mathematically using a simple model that accounts for <em>colonisation</em> and <em>extinction</em> rates of the species at local ‘patches’ of suitable habitat. Levin’s thus proposed, for the first time, a metapopulation model that would lay the foundations of metapopulation theory. The model took the form of a differential equation expressing the rate of change in the fraction of patches colonised through time as a function of <em>colonisation</em> and <em>extinction</em>.</p>
<p><img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Cdisplaystyle%20%0A%5Cfrac%7Bdp%7D%7Bdt%7D%20%3D%20cp%281-p%29%20-%20ep%0A" alt="
\frac{dp}{dt} = cp(1-p) - ep
" title="
\frac{dp}{dt} = cp(1-p) - ep
" class="math display" /> where <em>p</em> is the fraction of patches of habitat occupied by the species, and <em>c</em> and <em>e</em> are the colonisation and extinction rates of empty and occupied patches respectively. Solving this equation to its equilibrium, i.e. by making <img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Ctextstyle%20%5Cfrac%7Bdp%7D%7Bdt%7D%20%3D%200" alt="\frac{dp}{dt} = 0" title="\frac{dp}{dt} = 0" class="math inline" /> we obtain the equilibrium <img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Ctextstyle%20p%5E%2A%20%3D%201%20-%20e%2Fc" alt="p^* = 1 - e/c" title="p^* = 1 - e/c" class="math inline" />.</p>
<p>Ordinary differential equations (ODEs), such as the Levins’ metapopulation model, can be solved analytically (as we just did above when we found the equilibrium value <img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Ctextstyle%20p%5E%2A" alt="p^*" title="p^*" class="math inline" />) but can also be solved numerically. Numerically solving an ODE involves a series of mathematical tricks that allow us to <strong><em>approximate</em></strong> the next value of variable of interest based on a previous value and an infinitesimally small time over which it has changed using the tools of <strong><em>calculus</em></strong>. Luckily, nowadays all those mathematical complexities have conveniently been packed for us into software libraries that we can use out of the box to solve our equations. In R, one such library is called <strong>deSolve</strong>.</p>
<p>We can thus implement the Levins’ metapopulation model and solve it numerically:</p>
<pre class="r"><code># Simulating the Levins’ metapopulation model in continuous time
# import the numerical integration library
require(deSolve)

# This function implements the model
levins &lt;- function(t, p, parameters) {
  with(as.list(c(p, parameters)), {
    dp &lt;- c*p*(1-p) - e*p
    return(list(dp))
  }) 
}

# we define the parameters of the model: c = colonisation rate, e = extinction rate
parameters &lt;- c(c=0.15, e=0.05)
Initial.p &lt;- c(p=.1)
out.L &lt;- data.frame(ode(y=Initial.p, times=1:100, func=levins, parms=parameters))

# the plotting library
require(ggplot2)

# plot the results
qplot(x=out.L[,1], y=out.L[,2], geom=&quot;line&quot;, ylab=&quot;p&quot;, xlab=&quot;time&quot;)  +
  annotate(&quot;text&quot;, 75, .3, label=expression(over(dp,dt)==cp(1-p)-ep))</code></pre>
<p><img src="lesson-3_files/figure-html/setup-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p>In the example above we set the parameter values to <img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Ctextstyle%20c%3D0.15" alt="c=0.15" title="c=0.15" class="math inline" /> and <img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Ctextstyle%20e%3D0.05" alt="e=0.05" title="e=0.05" class="math inline" />. Using the expression for <img style="vertical-align:middle" src="https://latex.codecogs.com/png.latex?%5Ctextstyle%20p%5E%2A" alt="p^*" title="p^*" class="math inline" /> that we derived earlier we can calculate the exact equilibrium value for <em>p</em> and compare it to the outcome of our integration procedure. Try it out!</p>
<p>Using the code above, we can also perform some exhaustive explorations of the parameter space to evaluate the changes on the system’s behaviour when the values for the colonisation and extinction rates are altered. This can be useful to test hypotheses and make predictions about the effects of changes on colonisation and / or extinction rates due to external forcing, like for example environmental stressors.</p>
<pre class="r"><code># Exploring the parameters’ space for the Levins metapopulation model
extinctions &lt;- seq(0.01,1,length.out=30)        # range of values for e
colonisations &lt;- seq(0.01,1,length.out=30)      # range of values for c

# we create an empty matrix to store our results
N &lt;- matrix(0, nrow=length(extinctions), ncol=length(colonisations))

# the nested for loop to go over the e values and the c values
for(rep in 1:length(extinctions)){
  ext &lt;- extinctions[rep]
  for(rep2 in 1:length(colonisations)){
    col &lt;- colonisations[rep2]
    prms &lt;- c(c=col, e=ext)
    Initial.p &lt;- c(p=.1)
    
    # we use a larger time period to ensure equilibrium is achieved for all simulations
    out.L &lt;- data.frame(ode(y=Initial.p, times=1:100, func=levins, parms=prms))     
    N[rep, rep2] &lt;- out.L[100,2]
  }
} 

require(viridis)
fields::image.plot(x = colonisations, 
      z = t(N), 
      y = extinctions, 
      legend.lab = &#39;fraction occupied patches&#39;, col=viridis(128),
      xlab=&#39;colonisation rate&#39;, ylab=&#39;extinction rate&#39;)</code></pre>
<p><img src="lesson-3_files/figure-html/unnamed-chunk-1-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Metapopulations are a handy way of thinking about spatially explicit populations in which local dynamics and demographic processes are more or less independent but some exchange of individuals via <strong><em>dispersal</em></strong> occurs amongst populations. The simplest models like the Levins’ model above make several assumptions. For example, it is a central assumption that <strong><em>all patches have the same local conditions</em></strong>, i.e. there is no spatial heterogeneity, which might be realistic for the pests invading crops that Levins was studying. That assumption however, is likely to be violated in many natural systems in which, inevitably, some patches of habitats are “better” than others. By being “better” we mean that the growth rate of the population inhabiting a better patch is higher than the growth rate in a population in a “worse” patch.</p>
<p>Situations like this give rise to phenomena such as <strong><em>source-sink dynamics</em></strong>, in which source patches produce an excess of individuals that will then go on an disperse to other patches. If those patches receiving individuals from outside are in general bad for growth (i.e. growth rates of the populations within them are negative), they can’t really be sustained unless they have a constant influx from more prosperous patches. These former patches are thus sinks. When considered at the large spatial scale (i.e. the whole set of patches together) then the metapopulation will be considered to persist, whereas if we focus on only those “worse” patches we might think that the population is doomed to collapse.</p>
<center>
<img src="lesson-images/butterfly-metapop.png" width="500" />
</center>
<p>So, populations can persist regionally as a metapopulation even if some local populations might not persist for long.</p>
<p>Time also plays a role, with the quality of patches changing through time, making the metapopulation dynamics even more complex and harder to understand.</p>
</div>
<div id="metacommunities" class="section level2">
<h2>2.5- Metacommunities</h2>
<p>To add even more complexity to this whole picture we have to remember that all of these colonisations and extinctions to and from patches by a single species does not really happen in isolation. It happens in a community context (i.e. within communities containing other species) that is very dynamic. This realisation gave rise to metacommunity theory: a framework designed to think about spatially explicit local communities of many species connected via dispersal. Pretty much like a metapopulation but involving many species that might be interacting.</p>
<center>
<img src="lesson-images/metacom-paradigms.png" width="400" />
</center>
<center>
<strong>The four paradigms of metacommunity theory for two competing species.</strong> (a) patch-dynamics, (b) species sorting, (c) mass effects, and (d) neutral . Image taken from Leibold, MA (2004).
</center>
<p><br></p>
<p>In 2004, Leibold and colleagues, proposed a way of thinking about metacommunities that revolves around a combination of 4 <em>metacommunity paradigms</em>. These metacommunity paradigms summarise the ways in which local dynamics between species and the environment interact with regional dynamics of dispersal to give rise to regional patterns of biodiversity. In the patch dynamics paradigm (a in the figure above) landscape scale persistence and coexistence is given by a trade off between colonisation and competition. In this case species A is a superior competitor but poor coloniser (shown by the dashed arrows vs the thick arrows of B), whereas species B is a good coloniser but a bad competitor, so it is not able to colonise species A’s habitat (the square shaped large boxes). The species sorting paradigm (b in the figure) poses that competition is the strongest process determining species presence and as such dispersal is weak in general and all species are only found in their corresponding matching habitats (matching shapes of species and habitats). In the mass effects scenario (c), dispersal is so strong that it overrides any competitive advantage that species might have, allowing them to coexist everywhere. Finally, the neutral paradigm (d) suggests that all species are exactly the same and hence there are no real differences between communities at local scales.</p>
<p>This way of thinking about the multi-scale character of biodiversity and the patterns of biodiversity distribution has prompted much research into the mechanisms that give rise to biodiversity patterns across spatial scales. Theoretical frameworks like this can not only aid the understanding of community assembly but also the prediction of the potential effects of habitat loss on biodiversity.</p>
</div>
<div id="network-area-relationships" class="section level2">
<h2>2.6- Network-Area Relationships</h2>
<p>This way of thinking has <a href="https://www.nature.com/articles/s41559-018-0517-3">recently allowed us to extend the ideas of SARs into multispecies communities</a>. In particular, to the way that properties related to the networks of species interactions that characterise natural communities changes across spatial scales.</p>
<p>Using an extension of the Theory of Island Biogeography, and a meta-community model inspired on the metacommunty paradigms introduced above, we developed a theoretical framework to understand the influence of dispersal, colonisation and extinction on the scaling of biodiversity. The full model can be found <a href="https://github.com/mlurgi/network-area">here</a>.</p>
<p><strong><em>An Island Biogeography model for food webs:</em></strong> In this model, species occupancy depends not only on colonisation and extinction rates, but also on trophic constraints enforced in which a species can only be present in the community if at least one of its prey (as defined by the food web structure) is also present. Except for basal species which can be first colonisers.</p>
<pre class="r"><code>source(&#39;funcs.r&#39;)
# we explore the model using a colonisation rate and several values of extinction rates
# the ratio between these values determines the equilibrium number of species
c &lt;- 0.3
extinction &lt;- c(.1, .12, .15, .2, .3, .4, .5, .6, .7, .8, .95)

# since this is an stochastic model we perform several replicated simulations and analyse the average trend
replicates &lt;- 5

# number of timesteps per replicate
timesteps &lt;- 100

# in this data structure we store the output of our simulations
output &lt;- NULL
for(e in extinction){
  for(j in 1:replicates){
    file_name &lt;- paste0(&quot;https://raw.githubusercontent.com/mlurgi/serrapilheira_eco_networks/master/datasets/networks/network-&quot;,j,&quot;.rda&quot;)
    con &lt;- url(file_name) 
    load(con)
    close(con)
    S &lt;- food_web$S
    presences &lt;- array(0, S)
    for(i in 1:timesteps){
      #basal species
      basal_sps &lt;- which(colSums(food_web$M) == 0)
      cur_com &lt;- presences
      
      #this is what species are present
      present &lt;- which(cur_com != 0)
      
      if(sum(cur_com) != 0){
        
        #this is the set of species in the network that have prey in the current community
        with_prey &lt;- which(colSums(as.matrix(food_web$M[present, ])) &gt; 0)
        #this are the potential colonisers
        potential &lt;- append(basal_sps , with_prey)
        #to which we remove the ones that are already present
        potential &lt;- setdiff(potential, present)
        
      }else{
        potential &lt;- basal_sps
      }
      
      if(length(potential) != 0){
        colonisers &lt;- potential[which(runif(length(potential), 0, 1) &lt; c)]
        presences[colonisers] &lt;- 1
      }
      
      extinctions &lt;- FALSE
      if(length(present) != 0){
        extinct &lt;- present[which(runif(length(present), 0, 1) &lt; e)]
        if(length(extinct) != 0){
          presences[extinct] &lt;- 0
          extinctions &lt;- TRUE
        }
      }
      
      if(extinctions){
        cur_com &lt;- presences
        #this is what species are present
        present &lt;- which(cur_com != 0)
        #this is the set of species in the network that have prey in the current community
        with_prey &lt;- which(colSums(as.matrix(food_web$M[present, ])) &gt; 0)
        legal &lt;- union(with_prey, basal_sps)
        illegal &lt;- present[!(present %in% legal)]
        presences[illegal] &lt;- 0  
      }
      
    }
    
    results &lt;- presences
    net &lt;- food_web
    
    current_species &lt;- which(results &gt; 0)
    
    if(length(current_species) &lt; 2){
      next
    }
    
    M &lt;- net$M[current_species, current_species]
    C &lt;- sum(M)/((dim(M)[1])*(dim(M)[1]-1)) #Connectance if we prevent cannibalism
    
    mfcl &lt;- tryCatch({
      MeanFoodChainLength(M)
    }, warning = function(w) {
      &#39;NA&#39;
    }, error = function(e) {
      &#39;NA&#39;
    }, finally = {
      
    })
    
    mfcls &lt;- mfcl
    links &lt;- sum(M)
    indegree &lt;- Generality(M)
    outdegree &lt;- Vulnerability(M)
    basal &lt;- FractionOfBasal(M)
    top &lt;- FractionOfTop(M)
    intermediate &lt;- FractionOfIntermediate(M)
    sd_gen &lt;- SDGenerality(M)
    sd_vul &lt;- SDVulnerability(M)
    ratio &lt;- c/e
    colonization_rate &lt;- c
    extinction_rate &lt;- e
    
    cur_out &lt;- data.frame(replicate=j, S=length(current_species), C, links,  mfcls, indegree, outdegree, basal, top, intermediate, sd_gen, sd_vul, ratio, colonization_rate, extinction_rate)
    
    if(is.null(output)){
      output &lt;- cur_out
    }else{
      output &lt;- rbind(output, cur_out)
    } 
    
  }
}

ggplot(output, aes(log10(ratio*100), log10(links))) + geom_point() + theme_bw() + xlab(&#39;log10(c-e ratio)&#39;) + ylab(&#39;log10(number of interactions)&#39;) + geom_smooth(method=&#39;lm&#39;, se=FALSE, colour=&#39;red&#39;)</code></pre>
<p><img src="lesson-3_files/figure-html/unnamed-chunk-2-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p>On the x-axis we plot the ratio between colonisation and extinction as a proxy for the area sampled. Islands with bigger areas have a higher colonisation relative to extinction rates and hence higher chances of harbouring more species.</p>
<p>A meta-community model:</p>
<!-- ```{r warning=FALSE, message=FALSE, out.width="60%", fig.align='center'} -->
<!-- islands <- 75 -->
<!-- landscape <- space(islands, 0.3)[[2]] -->
<!-- landscape[landscape > 0] <- 1 -->
<!-- XY <- space(islands, 0.3)[[1]] -->
<!-- #parameters -->
<!-- c <- 0.1    #colonisation rate -->
<!-- e <- 0.4    #extinction rate -->
<!-- #d <- 0.1    #dispersal rate -->
<!-- # extinction_values <- c(.2, .3, .4, .5, .6, .7, .8) -->
<!-- # colonisations <- c(.01, .05, .1, .15, .2, .25, .3, .35, .4) -->
<!-- dispersals <- c(0,.01,.05,.1,.2,.3,.4,.5) -->
<!-- timesteps <- 1000 -->
<!-- replicates <- 5 -->
<!-- max_attempts <- 100 -->
<!-- output <- NULL -->
<!-- output_occupancy <- NULL -->
<!-- # for(c in colonisations){ -->
<!-- #   print(c) -->
<!-- #   for(e in extinction_values){ -->
<!-- #     print(e) -->
<!--     for(d in dispersals){ -->
<!--       print(d) -->
<!--       for(j in 1:replicates){ -->
<!--         print(j) -->
<!--         load(paste('../networks/network-',j,sep='')) -->
<!--         S <- food_web$S -->
<!--         presences <- array(0, c(islands,S)) -->
<!--         for(i in 1:timesteps){ -->
<!--           #basal species -->
<!--           basal_sps <- which(colSums(food_web$M) == 0) -->
<!--           for(isl in 1:islands){ -->
<!--             #this is the current community -->
<!--             cur_com <- presences[isl,] -->
<!--             #this is what species are present -->
<!--             present <- which(cur_com != 0) -->
<!--             #this is the set of species in the network that have prey in the current community -->
<!--             with_prey <- which(colSums(as.matrix(food_web$M[present, ])) > 0) -->
<!--             #this are the potential colonisers -->
<!--             potential <- append(basal_sps , with_prey) -->
<!--             #to which we remove the ones that are already present -->
<!--             potential <- setdiff(potential, present) -->
<!--             if(length(potential) != 0){ -->
<!--               colonisers <- potential[which(runif(length(potential), 0, 1) < c)] -->
<!--               presences[isl, colonisers] <- 1 -->
<!--             } -->
<!--             extinctions <- FALSE -->
<!--             if(length(present) != 0){ -->
<!--               extinct <- present[which(runif(length(present), 0, 1) < e)] -->
<!--               if(length(extinct) != 0){ -->
<!--                 presences[isl, extinct] <- 0 -->
<!--                 extinctions <- TRUE -->
<!--               } -->
<!--             } -->
<!--             if(extinctions){ -->
<!--               cur_com <- presences[isl,] -->
<!--               #this is what species are present -->
<!--               present <- which(cur_com != 0) -->
<!--               #this is the set of species in the network that have prey in the current community -->
<!--               with_prey <- which(colSums(as.matrix(food_web$M[present, ])) > 0) -->
<!--               legal <- union(with_prey, basal_sps) -->
<!--               illegal <- present[!(present %in% legal)] -->
<!--               presences[isl, illegal] <- 0   -->
<!--             } -->
<!--           } -->
<!--           ### dispersal after colonisation and extinction processes -->
<!--           #### we took this code from the metacomm model. Check Nuria's notes to see what they do -->
<!--           randCol = matrix(runif(islands*S,0,1),nr=islands,nc=S) -->
<!--           ColMat = matrix(0,nr=islands,nc=S) -->
<!--           ConPop = landscape%*%presences -->
<!--           LocalCol = 1-(1-d)^ConPop -->
<!--           LocalPrey = presences %*% food_web$M -->
<!--           LocalPrey[LocalPrey>0] = 1 -->
<!--           LocalPrey[,basal_sps] = 1 -->
<!--           ColMat[presences == 0 & LocalPrey == 1 & randCol<LocalCol] = 1 -->
<!--           presences = presences + ColMat -->
<!--         } -->
<!--         results <- presences # This is the community matrix presences -->
<!--         net <- food_web -->
<!--         occupancy <- c() -->
<!--         dietbreath <- c() -->
<!--         dispersal <- c() -->
<!--         occupancy <- append(occupancy, colMeans(results)) -->
<!--         dietbreath <- append(dietbreath, colSums(net$M)) -->
<!--         dispersal <- append(dispersal, d) -->
<!--         cur_out_occu <- data.frame(occupancy,dietbreath,rep(dispersal,length(occupancy))) -->
<!--       if(is.null(output_occupancy)){ -->
<!--         output_occupancy <- cur_out_occu -->
<!--       }else{ -->
<!--         output_occupancy <- rbind(output_occupancy, cur_out_occu) -->
<!--       }  -->
<!--         beta_total <- c() -->
<!--         beta_turn <- c() -->
<!--         beta_rich <- c() -->
<!--         beta_total <- append(beta_total, as.numeric(beta.multi.carv(results)[3])) -->
<!--         beta_turn <- append(beta_turn, as.numeric(beta.multi.carv(results)[1])) -->
<!--         beta_rich <- append(beta_rich, as.numeric(beta.multi.carv(results)[2])) -->
<!--         #### after obtaining the results we aggregate local communities and obtain network attributes  -->
<!--         species <- c() -->
<!--         area <-c() -->
<!--         C <- c() -->
<!--         links <- c() -->
<!--         mfcls <- c() -->
<!--         indegree <- c() -->
<!--         normalised_indegree <- c() -->
<!--         outdegree <- c() -->
<!--         normalised_outdegree <- c() -->
<!--         basal <- c() -->
<!--         top <- c() -->
<!--         intermediate <- c() -->
<!--         overlap <- c() -->
<!--         sd_gen <- c() -->
<!--         sd_vul <- c() -->
<!--         omnivory <- c() -->
<!--         S_top <- c() -->
<!--         S_intermediate <- c() -->
<!--         S_basal <- c() -->
<!--         SD_Gen <- c() -->
<!--         SD_Vul <- c() -->
<!--         ## Order patches across space -->
<!--         euc.dist <- function(x1, x2) sqrt(sum((x1 - x2) ^ 2)) -->
<!--         focal_coordinate <- c(0.5,0.5) -->
<!--         distance_focal <- c() -->
<!--         for (i in 1:islands){ -->
<!--           distance_focal <- append(distance_focal, euc.dist(focal_coordinate,XY[i,])) -->
<!--         } -->
<!--         results_ordered <- results[order(distance_focal),] #this orders the metacommunity matrix in respect to the center of the lanscape (focal_coordinate) -->
<!--         for(i in 1:islands){ -->
<!--           areas <- i -->
<!-- #           # aggregation random -->
<!-- #           patches_selected <- as.matrix(results[sample(nrow(results), i),]) -->
<!-- #            -->
<!-- #           if(i > 1){ -->
<!-- #             current_species_ran <- which(colSums(patches_selected[,]) > 0) -->
<!-- #              -->
<!-- #           }else{ -->
<!-- #             current_species_ran <- which(patches_selected[,] > 0) -->
<!-- #              -->
<!-- #           } -->
<!-- #           if(length(unique(current_species_ran)) <= 1){ -->
<!-- #             next -->
<!-- #           } -->
<!-- #            -->
<!-- #           M <- net$M[current_species_ran, current_species_ran] -->
<!-- #            -->
<!-- #           #we can check if the network is connected -->
<!-- #           graf <- igraph::graph.adjacency(M); # Making sure the network is connected -->
<!-- #           y <- igraph::no.clusters(graf, mode='weak'); -->
<!-- #           attempts <- 0 -->
<!-- #           while(y > 1 & attempts < max_attempts){ -->
<!-- #             patches_selected <- as.matrix(results[sample(nrow(results), i),]) -->
<!-- #              -->
<!-- #             if(i > 1){ -->
<!-- #               current_species_ran <- which(colSums(patches_selected[,]) > 0) -->
<!-- #                -->
<!-- #             }else{ -->
<!-- #               current_species_ran <- which(patches_selected[,] > 0) -->
<!-- #               print(i) -->
<!-- #             }     -->
<!-- #             M <- net$M[current_species_ran, current_species_ran] -->
<!-- #             graf <- igraph::graph.adjacency(M); # Making sure the network is connected -->
<!-- #             y <- igraph::no.clusters(graf, mode='weak'); -->
<!-- #              -->
<!-- #             attempts <- attempts + 1 -->
<!-- #           } -->
<!-- #            -->
<!-- #           if(length(unique(current_species_ran)) < 2 | attempts >= max_attempts){ -->
<!-- #             print('network not found') -->
<!-- #             next -->
<!-- #           } -->
<!-- #            -->
<!-- #               if(nrow(M) < 2){ -->
<!-- #                 next -->
<!-- #               } -->
<!-- #          write.table(M, paste(i ,"localmetacom_ran", ".txt", sep = ""), row.names=FALSE, col.names=FALSE) #Saving the local network -->
<!--           ## aggregation ordering them -->
<!--           if(i > 1){ -->
<!--             current_species_ran <-unique(which(colSums(results_ordered[1:i,]) > 0)) -->
<!--           }else{ -->
<!--             current_species_ran <- unique(which(results_ordered[1,] > 0)) -->
<!--           } -->
<!--           if(length(unique(current_species_ran)) <= 1){ -->
<!--             next -->
<!--           } -->
<!--           M <- net$M[current_species_ran, current_species_ran] -->
<!--           #we can check if the network is connected -->
<!--           graf <- igraph::graph.adjacency(M); # Making sure the network is connected -->
<!--           y <- igraph::no.clusters(graf, mode='weak'); -->
<!--           attempts <- 0 -->
<!--           while(y > 1 & attempts < max_attempts){ -->
<!--           patches_selected <- as.matrix(results[sample(nrow(results), i),]) -->
<!--           if(i > 1){ -->
<!--           current_species_ran <- which(colSums(patches_selected[,]) > 0) -->
<!--           }else{ -->
<!--           current_species_ran <- which(patches_selected[,] > 0) -->
<!--           print(i) -->
<!--           }     -->
<!--           M <- net$M[current_species_ran, current_species_ran] -->
<!--          graf <- igraph::graph.adjacency(M); # Making sure the network is connected -->
<!--          y <- igraph::no.clusters(graf, mode='weak'); -->
<!--          attempts <- attempts + 1 -->
<!--          } -->
<!--          if(length(unique(current_species_ran)) < 2 | attempts >= max_attempts){ -->
<!--           print('network not found') -->
<!--           next -->
<!--           } -->
<!--           if(nrow(M)<2){ -->
<!--             next -->
<!--           } -->
<!--           species <- append(species, length(current_species_ran)) -->
<!--           C <- append(C, sum(M)/((dim(M)[1])*(dim(M)[1]-1))) #Connectance if we prevent cannibalism -->
<!--           mfcl <- tryCatch({ -->
<!--             MeanFoodChainLength(M) -->
<!--           }, warning = function(w) { -->
<!--             'NA' -->
<!--           }, error = function(e) { -->
<!--             'NA' -->
<!--           }, finally = { -->
<!--           }) -->
<!--           mfcls <- append(mfcls, mfcl) -->
<!--           area <- append(area, areas) -->
<!--           links <- append(links, sum(M)) -->
<!--           indegree <- append(indegree, Generality(M)) -->
<!--           normalised_indegree <- append(normalised_indegree, NormalisedGenerality(M)) -->
<!--           outdegree <- append(outdegree, Vulnerability(M)) -->
<!--           normalised_outdegree <- append(normalised_outdegree, NormalisedVulnerability(M)) -->
<!--           basal <- append(basal, FractionOfBasal(M)) -->
<!--           top <- append(top, FractionOfTop(M)) -->
<!--           intermediate <- append(intermediate, FractionOfIntermediate(M)) -->
<!--           sd_gen <- append(sd_gen, SDGenerality(M)) -->
<!--           sd_vul <- append(sd_vul, SDVulnerability(M)) -->
<!--           overlap <- append(overlap, CalculatePredatorOverlap(M)) -->
<!--           omnivory <- append(omnivory, Omnivory(M)) -->
<!--           S_top <- append(S_top, NumberOfTop(M)) -->
<!--           S_intermediate <- append(S_intermediate, NumberOfIntermediate(M)) -->
<!--           S_basal <- append(S_basal, NumberOfBasal(M)) -->
<!--           SD_Vul <- append(SD_Vul, SDVulnerability(M)) -->
<!--           SD_Gen <- append(SD_Gen, SDGenerality(M)) -->
<!--           cur_out <- data.frame(rep(c,length(species)), rep(e,length(species)), rep(d,length(species)), rep(j,length(species)), beta_total, beta_rich, beta_turn, species, C, links, area,  indegree, normalised_indegree, outdegree, mfcls, normalised_outdegree, basal, top, intermediate, overlap, sd_gen, sd_vul, omnivory, S_top, S_intermediate, S_basal, SD_Gen, SD_Vul) -->
<!--         } -->
<!--         if(is.null(output)){ -->
<!--           output <- cur_out -->
<!--         }else{ -->
<!--           output <- rbind(output, cur_out) -->
<!--         }  -->
<!--       } -->
<!--      } -->
<!-- #   } -->
<!-- # } -->
<!-- #  -->
<!-- ``` -->
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>Arrhenius, O (1921) Species and area. <strong><em>Journal of Ecology</em></strong>, 9:1, 95-99.</p>
<p>Galiana, N, Lurgi, M, Claramunt-López, B. et al. (2018) The spatial scaling of species interaction networks. <strong><em>Nature Ecology &amp; Evolution</em></strong> 2, 782–790.</p>
<p>Leibold, MA et al. (2004), The metacommunity concept: a framework for multi-scale community ecology. <strong><em>Ecology Letters</em></strong>, 7, 601-613.</p>
<p>Levin, SA (1992), The problem of pattern and scale in ecology: The Robert H. MacArthur award lecture. <strong><em>Ecology</em></strong>, 73, 1943-1967.</p>
<p>Levins, R (1969) Some demographic and genetic consequences of environmental heterogeneity for biological control. <strong><em>Bulletin of the Entomological Society of America</em></strong>, 15(3), 237–240.</p>
<p>Lomolino, MV (2000) Ecology’s most general, yet protean pattern: The species-area relationship. <strong><em>Journal of Biogeography</em></strong>, 27, 17-26.</p>
<p>MacArthur RH, Wilson EO (1967). The theory of island biogeography. Princeton, N.J: Princeton University Press.</p>
<p>Preston, FW (1962) The canonical distribution of commonness and rarity: Part I. <strong><em>Ecology</em></strong>, 43:2, 185-215.</p>
</div>
<div id="continue-to-networks-as-graphs" class="section level2">
<h2><a href="lesson-4.html" class="continue-link">Continue to Networks as Graphs</a></h2>
</div>

  </div> <!-- lessonContent -->
</div> <!-- lessonPage -->


<script type="text/javascript">
  var lesson = window.location.href.match(/lesson-[0-9]+/g);
  if (lesson !== null) {
    lesson = 'nav-' + lesson[0];
    $('#'+lesson).addClass('current');
  }

  $('#show-answer').on("click", function() {
    $('#show-answer').addClass('showing');
    $('#model-answer').addClass('showing');
  })
</script>
  </div> <!-- articleBandContent -->
</div> <!-- pageContent -->

<div id="rStudioFooter" class="band full">
<div class="bandContent">
  <div id="copyright">© Copyright 2016 - 2020 RStudio, PBC</div>
  <div id="logos">
    <a href="https://twitter.com/rstudio" class="footerLogo twitter"></a>
    <a href="https://github.com/rstudio" class="footerLogo gitHub"></a>
    <a href="https://www.linkedin.com/company/rstudio-pbc" class="footerLogo linkedIn"></a>
    <a href="https://www.facebook.com/rstudioinc/" class="footerLogo facebook"></a>
  </div>
</div>
</div>

<!-- bizible -->
<script type="text/javascript" src="//cdn.bizible.com/scripts/bizible.js" async=""></script>

<!-- disqus -->
<div id="disqus_thread" class="standardPadding"></div>
<script type="text/javascript" src="js/disqus.js"></script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

<script type="text/javascript" src="js/external-links.js"></script>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->



</body>
</html>
